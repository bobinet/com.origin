##匿名协作框架
无中心开源设计


###cod运行机制
1. 根据运行需要发行codcoin。
2. 根据运行时间及质量向建模者、部署者支付codcoin报酬。
3. 根据实际任务完成情况向其他角色支付codcoin报酬。
4. 所有服务使用codcoin购买，codcoin持有者可以通过统一协议交易。

###cod部署
1. 无中心的cod部署方案，具体体现为一系列的cod node（以下简称node）。各node的差异只有公钥库和配置文件，执行文件是相同的（至少API是兼容的）。
2. 部署者根据com设计开发软件，把建模者的rsa公钥com.pub.key写入公钥库、建模参数写入com.ini文件，把自己的rsa公钥cod.pub.key写入公钥库、部署参数写入cod.ini文件。
3. 部署者部署的cod node，如果node使用新创建的rsa密钥对，则其它node无法识别它的用户是部署者本人。如果node导入部署者rsa密钥对（cod.pub.key,cod.sec.key），则意味着公开身份。
4. 如果com设计中为部署者保留了专有职权，虽然技术上可以隐藏部署者node，但事实上cod还是有中心角色的。但优先级低于其他角色的保底责任除外，即com设计可以为部署者硬性规定保底责任，只有其他成员不接受的任务，保底责任才能触发为任务，则该设计仍然为无中心的。
5. 部署者制作发布node部署包，即完成部署工作。node部署包内容包括：
    1. 一些执行文件，包括node部署和升级、从老版本导入数据的专用工具。
    2. 一个建模者配置文件com.ini
    3. 一个部署者配置文件cod.ini
    4. 一个node配置文件范例node.ini
    5. 一个部署指南文件。
    6. 一个公钥库，初始内容为建模者、部署者的公钥。
6. cod id根据node部署包生成。由于是开源软件，其他人更改公钥fork其它内容即可成为建模者、部署者。fork分支的cod id应不同于原cod，它们的node互相无法发现。
>   例如：torrent infohash(node部署包)

###node部署
1. 成员可以通过P2P下载等方式获得部署包，解压缩后阅读部署指南，修改node.ini然后执行对应的node部署脚本，即可创建一个cod node。
2. 每个node拥有自己的node rsa密钥对（node.pub.key,node.sec.key），可以在部署时导入或者创建。
3. node id根据node rsa公钥生成，生成方式应保证同一套rsa密钥对导入不同cod的node，产生的node id不同。例如：hash(node.pub.key + cod id)
4. 需要时，使用专用工具导入老版本的数据。

###node发现
1. node包括dht模块，负责node之间的自动发现。
2. dht模块会自动发布部署包、com.ini、cod.ini三个文件的torrent infohash，常年提供P2P下载。
3. dht模块通过dht协议（BEP5）查找部署包和com.ini、cod.ini文件。由于三个infohash不会很接近，因此同时提供的dht node很可能也是cod node。这样就是实现了无中心的自动发现，然后cod node之间即可通过RESTful cod API交互。
>    代码范例：[nanjingtaxi](https://github.com/chewxy/nanjingtaxi)

###node升级
1. node之间通过专门的API查询对方的版本号，包括com版本和cod版本。
2. 当遇到更新版本时node通知成员，确认后开始下载。由于每个node都提供当前版本部署包的P2P下载，这很容易完成。各node还鼓励用户提供若干个兼容老版本的部署包下载。
3. 下载成功后node通知成员进行新版本部署，详见“node部署”一节。
4. 不同版本的cod node各自保持独立部署，由成员自愿决定启用、卸载。

###coin
1. node包括coin模块。
2. coin模块管理codcoin的数据块，包括发行、交易、分配三种记录。
3. codcoin是cod发行的内部记账单位，通常以cod的产品作为抵押。
4. 记录的数据结构主要内容：
	- record type：数据块种类发行、交易、分配。
	- record time：发生时间。
	- record content：记录内容，根据种类不同。
	- sig type：签名算法名称，目前是rsa。如果算法被证实不安全，此处可以引入新算法。
	- record sig：数字签名。其中发行、分配记录包含多名成员以及本成员的签名，交易记录只需要本成员签名。
5. 每个node id标识其独立的资产专户。协作网络有独立的资产专户，其id规则不同于node id。
6. 数据块组成块链，各node均同步保存在本地。具体机制应满足以下条件：
	1. node可以检验本地块链是否完整。
	2. node可以下载到本地缺少的数据块。
	3. 创造数据块的node下线后，其它node仍然可以取得完整块链。在任何时候有node在线时应能实现需求，争取实现：所有保存新数据块的node全部下线之后，另一些node上线。
>   由于数据块无需保密、无法伪造、可以付费。可选方案很多，因此不指定具体方式。    
>   例如：群发email、委托云服务商保存、git托管商、置入P2P下载网络、分布式缓存技术，或参考bitcoin模式。

7. 由于数据结构是公开的，rsa密钥对可以导入导出（coin模块也可以开源），因此其它软件也可以实现coin模块的功能。

####发行
1. cod的产品只限codcoin购买。
2. 发行codcoin的发行种类有限且已知，算法明文公布。具体规则应在cod部署时公布（通常在com就已经明确）。
3. 发行记录record content的数据结构应满足以下要求：
	1. 任何成员可以独立生成记录内容。（不设置专用私钥）
	2. 任何成员可以独立检验记录内容的正确性。
	3. 任何诚实的成员检验结果一致。
>   具体技术机制已完成，由于用途不仅限于匿名协作网络，将另外整理发布。

####交易
1. 交易记录record content的数据结构主要包括以下内容：
	- 转出专户id
	- 转入专户
		- 专户id
		- 资产种类
		- 数额
	- sig Type：默认rsa。
	- 转出专户数字签名

####分配
1. 在每个结算周期末进行一次分配。特别分配的发起由com定义。
2. 分配种类有限且已知，算法明文公布。具体规则应在cod部署时公布（通常在com就已经明确）。
3. 分配记录record content的数据结构应满足以下要求：
	1. 任何成员可以独立生成记录内容。（不设置专用私钥）
	2. 任何成员可以独立检验记录内容的正确性。
	3. 任何诚实的成员检验结果一致。
>   具体技术机制已完成，由于用途不仅限于匿名协作网络，将另外整理发布。